<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Contractor</title>
  <link rel="stylesheet" href="/theme.css">
</head>
<body>
  <div class="contractor-page">
    <a href="/" class="back">← Home</a>
    <div id="contractor-root">
      <div id="contractor-info">
        <img id="contractor-logo" src="/assets/default-logo.png" alt="logo" style="width:100px;height:100px;object-fit:cover;border-radius:8px"/>
        <h1 id="contractor-name"></h1>
        <div id="contractor-badge"></div>
        <div id="contractor-service"></div>
        <div id="contractor-phone"></div>
        <div id="contractor-reviews"></div>
        <button id="contact-contractor">Contact / Open chat</button>
      </div>
    </div>
  </div>

<script>
(async function(){
  const id = location.pathname.split("/c/")[1];
  if (!id) return document.getElementById('contractor-root').innerText = "Invalid contractor id";
  const r = await fetch(`/api/contractor/${id}`);
  const j = await r.json();
  const c = j.contractor || j;
  if (!c) return document.getElementById('contractor-root').innerText = "Contractor not found";
  document.getElementById('contractor-name').textContent = c.name || c.company || "No name";
  document.getElementById('contractor-service').textContent = c.service || "";
  document.getElementById('contractor-phone').textContent = c.phone || "";
  if (c.logo) document.getElementById('contractor-logo').src = c.logo;
  if (c.badge) document.getElementById('contractor-badge').textContent = c.badge;
  const reviews = j.reviews || [];
  const revEl = document.getElementById('contractor-reviews');
  revEl.innerHTML = reviews.map(r=>`<div class="rev"><strong>${r.reviewer_name||r.name||''}</strong> ${'★'.repeat(r.rating||0)}<p>${r.comment||''}</p></div>`).join("");
  document.getElementById('contact-contractor').addEventListener('click', ()=>{
    // deep-link to chat with service prefilled
    window.open('/', '_self'); // you can build more advanced deep link if needed
  });
})();
</script>
</body>
</html>
